<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <script>
      window.process = { env: { NODE_ENV: 'development' } };
  </script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  
  <!-- åº”ç”¨ä¿¡æ¯ -->
  <title>T-Translate</title>
  <meta name="description" content="ä¸“ä¸šçš„ç¦»çº¿ç¿»è¯‘å·¥å…·ï¼Œæ”¯æŒOCRè¯†åˆ«å’Œæœ¬åœ°LLMç¿»è¯‘">
  <meta name="author" content="Your Name">
  
  <!-- å®‰å…¨ç­–ç•¥ -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    script-src 'self' 'unsafe-inline' 'unsafe-eval' blob: https://cdn.jsdelivr.net;
    style-src 'self' 'unsafe-inline' https://fonts.googleapis.com;
	worker-src 'self' blob: https://cdn.jsdelivr.net;
    font-src 'self' data: https://fonts.gstatic.com https://fonts.googleapis.com;
    img-src 'self' data: blob: https:;
    connect-src 'self' http://localhost:* ws://localhost:* http://127.0.0.1:* ws://127.0.0.1:* https: data:;
  ">
  
  <!-- ç¦æ­¢ç¼“å­˜ï¼ˆå¼€å‘ç¯å¢ƒï¼‰ -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  
  <!-- ä¸»é¢˜è‰² -->
  <meta name="theme-color" content="#3b82f6">
  
  <!-- å›¾æ ‡ -->
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  
  <!-- é¢„åŠ è½½å­—ä½“ -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- åŸºç¡€æ ·å¼ -->
  <style>
    /* åŠ è½½ç”»é¢æ ·å¼ */
    #loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      transition: opacity 0.5s ease;
    }

    #loading-screen.fade-out {
      opacity: 0;
      pointer-events: none;
    }

    .loading-logo {
      width: 80px;
      height: 80px;
      margin-bottom: 20px;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% {
        transform: scale(1);
        opacity: 1;
      }
      50% {
        transform: scale(1.1);
        opacity: 0.8;
      }
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    .loading-text {
      color: white;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      font-size: 16px;
      font-weight: 500;
      margin-top: 10px;
    }

    .loading-progress {
      width: 200px;
      height: 4px;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 2px;
      margin-top: 20px;
      overflow: hidden;
    }

    .loading-progress-bar {
      height: 100%;
      background: white;
      border-radius: 2px;
      animation: progress 2s ease-in-out infinite;
    }

    @keyframes progress {
      0% {
        width: 0%;
        margin-left: 0;
      }
      50% {
        width: 60%;
        margin-left: 0;
      }
      100% {
        width: 100%;
        margin-left: 100%;
      }
    }

    /* é”™è¯¯æç¤ºæ ·å¼ */
    .error-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #f5f5f5;
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9998;
      padding: 20px;
      text-align: center;
    }

    .error-icon {
      font-size: 64px;
      margin-bottom: 20px;
    }

    .error-title {
      font-size: 24px;
      font-weight: 600;
      color: #333;
      margin-bottom: 10px;
    }

    .error-message {
      font-size: 16px;
      color: #666;
      margin-bottom: 20px;
      max-width: 500px;
    }

    .error-details {
      font-family: monospace;
      font-size: 12px;
      color: #999;
      background: white;
      padding: 10px;
      border-radius: 4px;
      max-width: 600px;
      max-height: 200px;
      overflow: auto;
      margin-top: 10px;
    }

    .retry-button {
      padding: 10px 20px;
      background: #3b82f6;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .retry-button:hover {
      background: #2563eb;
    }

    /* é˜²æ­¢é—ªçƒ */
    body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: #ffffff;
      opacity: 0;
      animation: fadeIn 0.3s ease forwards;
      animation-delay: 0.1s;
    }

    @keyframes fadeIn {
      to {
        opacity: 1;
      }
    }

    /* æ ¹å…ƒç´ æ ·å¼ */
    #root {
      width: 100%;
      height: 100vh;
      overflow: hidden;
    }

    /* æ— è„šæœ¬æç¤º */
    noscript {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: #f5f5f5;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      font-size: 18px;
      color: #333;
      text-align: center;
      padding: 20px;
    }
  </style>
</head>
<body>
  <!-- åŠ è½½ç”»é¢ -->
  <div id="loading-screen">
    <svg class="loading-logo" viewBox="0 0 100 100">
      <rect x="20" y="20" width="60" height="60" fill="white" rx="8"/>
      <text x="50" y="58" font-family="Arial" font-size="32" font-weight="bold" fill="#667eea" text-anchor="middle">T</text>
    </svg>
    <div class="loading-spinner"></div>
    <div class="loading-text">T-Translate Core å¯åŠ¨ä¸­...</div>
    <div class="loading-progress">
      <div class="loading-progress-bar"></div>
    </div>
  </div>

  <!-- é”™è¯¯æç¤º -->
  <div id="error-screen" class="error-screen">
    <div class="error-icon">âš ï¸</div>
    <div class="error-title">åŠ è½½å¤±è´¥</div>
    <div class="error-message">åº”ç”¨ç¨‹åºé‡åˆ°äº†ä¸€äº›é—®é¢˜ï¼Œè¯·å°è¯•åˆ·æ–°é¡µé¢</div>
    <button class="retry-button" onclick="window.location.reload()">é‡æ–°åŠ è½½</button>
    <div id="error-details" class="error-details"></div>
  </div>

  <!-- React æ ¹èŠ‚ç‚¹ -->
  <div id="root"></div>

  <!-- æ— è„šæœ¬æç¤º -->
  <noscript>
    <div>
      <h1>âš ï¸ JavaScript è¢«ç¦ç”¨</h1>
      <p>T-Translate Core éœ€è¦ JavaScript æ‰èƒ½æ­£å¸¸è¿è¡Œã€‚</p>
      <p>è¯·åœ¨æµè§ˆå™¨è®¾ç½®ä¸­å¯ç”¨ JavaScript ååˆ·æ–°é¡µé¢ã€‚</p>
    </div>
  </noscript>

  <!-- åŠ è½½æ£€æµ‹è„šæœ¬ -->
  <script>
    // æ–¹æ¡ˆ A: ç®€å•ç²—æš´åœ°å®šä¹‰å®ƒï¼Œé˜²æ­¢æŠ¥é”™
    //window.dragEvent = null;

    // æ–¹æ¡ˆ B: å¦‚æœä½ æƒ³çŸ¥é“åˆ°åº•æ˜¯è°åœ¨è°ƒç”¨å®ƒï¼Œå¯ä»¥ç”¨ä¸‹é¢è¿™æ®µï¼ˆä¼šæ‰“å°è°ƒç”¨æ ˆï¼‰
    try {
      Object.defineProperty(window, 'dragEvent', {
        get: function() {
          console.warn("ğŸ•µï¸â€â™‚ï¸ æŠ“åˆ°äº†ï¼æœ‰ä¸ªåœ°æ–¹æ­£åœ¨å°è¯•è¯»å– dragEvent");
          console.trace(); // è¿™ä¼šåœ¨æ§åˆ¶å°æ‰“å°å‡ºæ˜¯è°è°ƒç”¨çš„
          return {}; // è¿”å›ä¸€ä¸ªç©ºå¯¹è±¡ï¼Œé˜²æ­¢ crash
        },
        set: function(val) {
          // å…è®¸èµ‹å€¼
        }
      });
    } catch (e) {}
  </script>
  <script>
    // é”™è¯¯æ•è·
    window.addEventListener('error', function(event) {
      console.error('Global error:', event.error);
      
      // å¦‚æœæ˜¯åŠ è½½é˜¶æ®µçš„é”™è¯¯ï¼Œæ˜¾ç¤ºé”™è¯¯é¡µé¢
      if (!window.__APP_LOADED__) {
        const errorScreen = document.getElementById('error-screen');
        const errorDetails = document.getElementById('error-details');
        
        if (errorScreen) {
          errorScreen.style.display = 'flex';
          if (errorDetails && event.error) {
            errorDetails.textContent = event.error.stack || event.error.message || 'æœªçŸ¥é”™è¯¯';
          }
        }
        
        // éšè—åŠ è½½ç”»é¢
        const loadingScreen = document.getElementById('loading-screen');
        if (loadingScreen) {
          loadingScreen.style.display = 'none';
        }
      }
    });

    // æœªå¤„ç†çš„ Promise é”™è¯¯
    window.addEventListener('unhandledrejection', function(event) {
      console.error('Unhandled promise rejection:', event.reason);
    });

    // æ£€æµ‹ Electron ç¯å¢ƒ
    if (typeof window !== 'undefined' && window.process && window.process.type === 'renderer') {
      console.log('Running in Electron');
      
      // Electron ç‰¹å®šçš„åˆå§‹åŒ–
      document.addEventListener('DOMContentLoaded', function() {
        // ç¦æ­¢é»˜è®¤çš„æ‹–æ‹½è¡Œä¸º
        document.addEventListener('dragover', function(e) {
          e.preventDefault();
          return false;
        });
        
        document.addEventListener('drop', function(e) {
          e.preventDefault();
          return false;
        });
      });
    } else {
      console.log('Running in Browser');
    }

    // åº”ç”¨åŠ è½½å®Œæˆæ ‡è®°
    window.__APP_LOADED__ = false;

    // ç›‘å¬åº”ç”¨åŠ è½½å®Œæˆ
    window.addEventListener('app-ready', function() {
      window.__APP_LOADED__ = true;
      
      // æ·¡å‡ºåŠ è½½ç”»é¢
      const loadingScreen = document.getElementById('loading-screen');
      if (loadingScreen) {
        loadingScreen.classList.add('fade-out');
        setTimeout(function() {
          loadingScreen.style.display = 'none';
        }, 500);
      }
    });

    // è¶…æ—¶å¤„ç†ï¼ˆ10ç§’ï¼‰
    setTimeout(function() {
      if (!window.__APP_LOADED__) {
        console.warn('App loading timeout');
        
        const loadingScreen = document.getElementById('loading-screen');
        const loadingText = loadingScreen?.querySelector('.loading-text');
        
        if (loadingText) {
          loadingText.textContent = 'åŠ è½½æ—¶é—´è¾ƒé•¿ï¼Œè¯·ç¨å€™...';
        }
        
        // å†ç­‰å¾…10ç§’
        setTimeout(function() {
          if (!window.__APP_LOADED__) {
            const errorScreen = document.getElementById('error-screen');
            if (errorScreen) {
              errorScreen.style.display = 'flex';
              const errorMessage = errorScreen.querySelector('.error-message');
              if (errorMessage) {
                errorMessage.textContent = 'åŠ è½½è¶…æ—¶ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–åˆ·æ–°é¡µé¢é‡è¯•';
              }
            }
            if (loadingScreen) {
              loadingScreen.style.display = 'none';
            }
          }
        }, 10000);
      }
    }, 10000);

    // å¼€å‘ç¯å¢ƒçƒ­é‡è½½æ”¯æŒ
    if (process.env.NODE_ENV === 'development') {
      console.log('Development mode enabled');
    }
  </script>

  <!-- Vite/React å…¥å£è„šæœ¬ -->
  <script type="module" src="/src/main.jsx"></script>
</body>
</html>
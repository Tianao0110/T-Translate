# æ¶æ„å®¡æŸ¥æŠ¥å‘Š

## M-V-S-P å››å±‚æ¶æ„å®ç°å®¡æŸ¥

**å®¡æŸ¥æ—¥æœŸ**: 2025-01-14  
**ç‰ˆæœ¬**: v0.1.3

---

## ğŸ“Š æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   View Layer (React)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Translation  â”‚ â”‚   Settings   â”‚ â”‚  Glass/Selection     â”‚ â”‚
â”‚  â”‚    Panel     â”‚ â”‚    Panel     â”‚ â”‚    Translator        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                â”‚                    â”‚
          â–¼                â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Service Layer                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ main-translationâ”‚ â”‚ translator â”‚ â”‚ pipeline/translationâ”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                â”‚                   â”‚
            â–¼                â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Provider Layer                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚local-llmâ”‚ â”‚ openai â”‚ â”‚ deepl â”‚ â”‚ gemini â”‚ â”‚ deepseek â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚google-translate â”‚ â”‚           OCR Engines            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                â”‚                   â”‚
            â–¼                â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Model Layer (Zustand)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ translation-storeâ”‚ â”‚  session  â”‚ â”‚       config       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… å„åŠŸèƒ½å®¡æŸ¥ç»“æœ

### 1. ä¸»çª—å£ç¿»è¯‘ âœ…

| å±‚çº§ | æ–‡ä»¶ | èŒè´£ | çŠ¶æ€ |
|------|------|------|:----:|
| View | `TranslationPanel.jsx` | UI å±•ç¤ºã€ç”¨æˆ·äº¤äº’ | âœ… |
| Service | `main-translation.js` | ç¿»è¯‘é€»è¾‘ã€æµå¼å¤„ç† | âœ… |
| Provider | `registry.js` â†’ å„ provider | è°ƒç”¨ç¿»è¯‘ API | âœ… |
| Model | `translation-store.js` | çŠ¶æ€ç®¡ç†ã€å†å²è®°å½• | âœ… |

**æ•°æ®æµ**:
```
ç”¨æˆ·è¾“å…¥ â†’ TranslationPanel â†’ mainTranslation.streamTranslate()
         â†’ translator.streamTranslate() â†’ provider.translate()
         â†’ translation-store (æ›´æ–°çŠ¶æ€)
```

---

### 2. ç»ç’ƒçª—å£ç¿»è¯‘ âœ…

| å±‚çº§ | æ–‡ä»¶ | èŒè´£ | çŠ¶æ€ |
|------|------|------|:----:|
| View | `GlassTranslator/index.jsx` | æ‚¬æµ®çª— UI | âœ… |
| Service | `pipeline.js` | æµæ°´çº¿å¤„ç†ã€å­—å¹•æ¨¡å¼ | âœ… |
| Provider | `translation.js` â†’ providers | ç¿»è¯‘è°ƒç”¨ | âœ… |
| Model | `session.js` | ç»ç’ƒçª—å£çŠ¶æ€ | âœ… |

**æ•°æ®æµ**:
```
ç”¨æˆ·è¾“å…¥ â†’ GlassTranslator â†’ pipeline.translate()
         â†’ translationService.translate() â†’ provider
         â†’ session store (æ›´æ–°çŠ¶æ€)
```

---

### 3. åˆ’è¯ç¿»è¯‘ âœ…

| å±‚çº§ | æ–‡ä»¶ | èŒè´£ | çŠ¶æ€ |
|------|------|------|:----:|
| View | `SelectionTranslator.jsx` | ç¿»è¯‘å¼¹çª— UI | âœ… |
| Service | `translation.js` | ç¿»è¯‘æœåŠ¡ | âœ… |
| Provider | å„ provider | ç¿»è¯‘ API | âœ… |
| Model | é€šè¿‡ IPC â†’ `translation-store` | å†å²è®°å½• | âœ… |

**æ•°æ®æµ**:
```
é¼ æ ‡é€‰ä¸­ â†’ main.js (uiohook) â†’ æ˜¾ç¤ºè§¦å‘å™¨
ç‚¹å‡»ç¿»è¯‘ â†’ SelectionTranslator â†’ translationService.translate()
         â†’ IPC â†’ App.jsx â†’ translation-store (æ·»åŠ å†å²)
```

---

### 4. æ–‡æ¡£ç¿»è¯‘ âœ…

| å±‚çº§ | æ–‡ä»¶ | èŒè´£ | çŠ¶æ€ |
|------|------|------|:----:|
| View | `DocumentTranslator/index.jsx` | æ–‡æ¡£ UIã€è¿›åº¦æ˜¾ç¤º | âœ… |
| Service | `translator.js` | ç¿»è¯‘è°ƒåº¦ | âœ… |
| Provider | å„ provider | ç¿»è¯‘ API | âœ… |
| Model | `translation-store.js` | çŠ¶æ€ç®¡ç† | âœ… |

**æ•°æ®æµ**:
```
ä¸Šä¼ æ–‡æ¡£ â†’ DocumentTranslator â†’ è§£æ (pdfjs/mammoth)
         â†’ translator.translate() â†’ provider
         â†’ æ˜¾ç¤ºç»“æœ
```

---

### 5. æˆªå›¾ OCR âœ…

| å±‚çº§ | æ–‡ä»¶ | èŒè´£ | çŠ¶æ€ |
|------|------|------|:----:|
| View | `TranslationPanel.jsx` | è§¦å‘æˆªå›¾ã€æ˜¾ç¤ºç»“æœ | âœ… |
| Service | `main-translation.js` | OCR å¤„ç† | âœ… |
| Provider | `ocr/*.js` | OCR å¼•æ“ | âœ… |
| Model | `translation-store.js` | çŠ¶æ€ç®¡ç† | âœ… |

**æ•°æ®æµ**:
```
å¿«æ·é”® â†’ main.js (æˆªå›¾) â†’ TranslationPanel (setPendingScreenshot)
       â†’ mainTranslation.recognizeImage() â†’ ocrManager
       â†’ translation-store (è®¾ç½® sourceText)
```

---

### 6. å†å²è®°å½• âœ…

| å±‚çº§ | æ–‡ä»¶ | èŒè´£ | çŠ¶æ€ |
|------|------|------|:----:|
| View | `HistoryPanel.jsx` | åˆ—è¡¨å±•ç¤ºã€æœç´¢ | âœ… |
| Service | - | ç›´æ¥æ“ä½œ Store | âœ… |
| Provider | - | æ— éœ€ Provider | - |
| Model | `translation-store.js` | å†å²æ•°æ®å­˜å‚¨ | âœ… |

---

### 7. æ”¶è—å¤¹ âœ…

| å±‚çº§ | æ–‡ä»¶ | èŒè´£ | çŠ¶æ€ |
|------|------|------|:----:|
| View | `FavoritesPanel.jsx` | æ”¶è—åˆ—è¡¨ã€æ–‡ä»¶å¤¹ | âœ… |
| Service | - | ç›´æ¥æ“ä½œ Store | âœ… |
| Provider | - | æ— éœ€ Provider | - |
| Model | `translation-store.js` | æ”¶è—æ•°æ®å­˜å‚¨ | âœ… |

---

### 8. è®¾ç½®é¢æ¿ âœ…

| å±‚çº§ | æ–‡ä»¶ | èŒè´£ | çŠ¶æ€ |
|------|------|------|:----:|
| View | `SettingsPanel.jsx` | è®¾ç½® UI | âœ… |
| Service | - | ç›´æ¥æ“ä½œ Registry | âœ… |
| Provider | `registry.js` | Provider é…ç½®ç®¡ç† | âœ… |
| Model | `electron-store` (ä¸»è¿›ç¨‹) | æŒä¹…åŒ–å­˜å‚¨ | âœ… |

---

## ğŸ“ æ–‡ä»¶ç»Ÿè®¡

| å±‚çº§ | æ–‡ä»¶æ•° | æ€»è¡Œæ•° | è¯´æ˜ |
|------|:------:|:------:|------|
| View | 11 | ~3500 | React ç»„ä»¶ |
| Service | 6 | ~1200 | ä¸šåŠ¡é€»è¾‘ |
| Provider | 12 | ~1500 | ç¿»è¯‘æºå®ç° |
| Model | 3 | ~700 | çŠ¶æ€ç®¡ç† |
| Electron | 5 | ~4500 | ä¸»è¿›ç¨‹ |

**æ€»è®¡**: ~11,400 è¡Œä»£ç 

---

## ğŸ” æ¶æ„åˆè§„æ€§è¯„ä¼°

### âœ… ä¼˜ç‚¹

1. **å±‚çº§æ¸…æ™°** - View ä¸ç›´æ¥è°ƒç”¨ Providerï¼Œé€šè¿‡ Service ä¸­è½¬
2. **å•å‘æ•°æ®æµ** - View â†’ Service â†’ Provider â†’ Model
3. **å…³æ³¨ç‚¹åˆ†ç¦»** - æ¯å±‚èŒè´£æ˜ç¡®
4. **å¯æµ‹è¯•æ€§** - Service å’Œ Provider å¯ç‹¬ç«‹æµ‹è¯•

### âš ï¸ æ³¨æ„äº‹é¡¹

1. **SettingsPanel è¾ƒå¤§** - 2800+ è¡Œï¼Œå¯è€ƒè™‘æ‹†åˆ†
2. **main.js è¾ƒå¤§** - 4000+ è¡Œï¼ŒåŒ…å«å¤šä¸ªåŠŸèƒ½æ¨¡å—
3. **éƒ¨åˆ† View ç›´æ¥æ“ä½œ Store** - å†å²/æ”¶è—é¢æ¿ç›´æ¥è°ƒç”¨ Storeï¼ˆå¯æ¥å—ï¼Œå› ä¸ºé€»è¾‘ç®€å•ï¼‰

---

## ğŸ“‹ ç»“è®º

**æ¶æ„å®¡æŸ¥é€šè¿‡** âœ…

æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½éƒ½éµå¾ª M-V-S-P å››å±‚æ¶æ„ï¼š
- View å±‚è´Ÿè´£ UI å±•ç¤º
- Service å±‚è´Ÿè´£ä¸šåŠ¡é€»è¾‘
- Provider å±‚è´Ÿè´£å¤–éƒ¨æœåŠ¡è°ƒç”¨
- Model å±‚è´Ÿè´£çŠ¶æ€ç®¡ç†

ä»£ç è´¨é‡è‰¯å¥½ï¼Œæ¶æ„è®¾è®¡åˆç†ï¼Œä¾¿äºåç»­ç»´æŠ¤å’Œæ‰©å±•ã€‚
